<#
.SYNOPSIS
Add/Update/Delete a tenant group in the CIPP system.

.DESCRIPTION
The Set-CIPPTenantGroup function is used to add, edit, or remove a tenant group from the CIPP system. 

.PARAMETER Action
Add/Delete/Update

.PARAMETER TenantGroupID
Specifies the ID

.PARAMETER Name
Only for use when creating a new group.

.PARAMETER Description
Updates the group description, if provided.

.PARAMETER AddMembers
Indicates whether to add a customer tenant to the membership list of the group. This switch cannot be used together with the RemoveMember switch.
This needs to be an array of customer tenant ID Guids (1fefeb73-0947-4803-a720-92be0e9a7d8e)

.PARAMETER RemoveMembers
Indicates whether to remove the customer tenant from the exclusion list. This switch cannot be used together with the AddExclusion switch.
This needs to be an array of customer tenant ID Guids (1fefeb73-0947-4803-a720-92be0e9a7d8e)

.EXAMPLE


#>
function Set-CIPPTenantGroup {
    [CmdletBinding()]
    Param(
        [Parameter(Mandatory = $true)]
        [ValidateSet('AddEdit', 'Delete')] 
        [string]$Action,
        [Parameter()]
        [string]$TenantGroupId,
        [Paramter()]
        [string]$GroupName,
        [Paramter()]
        [string]$GroupDescription,
        [Parameter()]
        [switch]$AddMembers,
        [Parameter()]
        [switch]$RemoveMembers
    )

    # Ensure only one of the Member change switches is used
    if ($AddMembers -and $RemoveMembers) {
        throw 'You cannot use both -AddMember and -RemoveMember switches at the same time.'
    }

    $endpoint = '/api/EditTenantGroup'

    if ($Action -EQ 'Add') {
        if (-not $GroupName -and -not $Description -and -not $AddMember) {
            throw 'Missing required field(s) for action `'AddEdit`''
        }

        $existingGroup = $null
        if ($TenantGroupId) {
           Write-Verbose 'Checking for existing group.'
           $existingGroup = Get-CippTenantGroups | Where-Object $_.Name -EQ $GroupName 
        }

        if (-not $existingGroup) {

           $params = @{}
           $body = @{
                Action = 'AddEdit',
                groupName = $GroupName,
                groupDescription = $GroupDescription,
                members = $AddMembers
              }  
           Write-Verbose "Adding new Tenant Group `'$Name`'."
           Invoke-CIPPRestMethod -Endpoint $endpoint -Params $params -Body $body -Method POST
        } else {
             throw 'Tenant Group with the specified name already exisits.'
        }
       
        
    }

    if ($Action -EQ 'Edit' -and -not $Description -and -not $AddMember -and -not $RemoveMember) {
        throw 'You must specify at least 1 property to update.'

        $params = @{}
        $body = @{
           Action = 'AddEdit'
        }
        Write-Verbose "Updating Tenant Group $CustomerTenantID."
        Invoke-CIPPRestMethod -Endpoint $endpoint -Params $params -Body $body -Method POST
    }

    if ($Action -EQ 'Delete' -and -not $TenantGroupID) {
        throw 'Tenant Group to be deleted not specified'

        $params = @{}
        $body = @{
            ???
        }
        Write-Verbose "Deleting Tenant Group $TenantGroupID."
        Invoke-CIPPRestMethod -Endpoint $endpoint -Params $params -Body $body -Method POST
    }
}
